# Automation Document Schema and Syntax<a name="automation-doc-syntax"></a>

The syntax of your Automation document, or playbook, is defined by the schema version used to create it\.

**Note**  
For information about the SSM Command document schema, see [SSM Document Schemas and Features](document-schemas-features.md) and [SSM Document Syntax](sysman-doc-syntax.md)\.

## Schema Elements<a name="automation-doc-syntax-schema"></a>

 Automation documents use schema version 0\.3\. Automation documents that use this schema version include the following top\-level elements\. 

**description**  
\(Optional\) Information to describe the purpose of the document\. You can use Markdown, a markup language, which allows you to add wiki\-style formatting to your document description\. For more information on using Markdown, see [Using Markdown in AWS](https://docs.aws.amazon.com/general/latest/gr/aws-markdown.html)\.

**schemaVersion**  
\(Required\) The schema version in use for the document\. Automation documents use schema version 0\.3\.

**assumeRole**  
\(Optional\) The ARN of the IAM role that allows Automation to perform the actions on your behalf\.  
In most cases, if no role is specified, AWS Systems Manager Automation can use the permissions of the user that runs an Automation document to start the automation execution\. However, in some scenarios, an IAM role *must* be specified\. For information, see [Configuring a Service Role \(Assume Role\) Access for Automation Workflows](automation-setup.md#automation-setup-configure-role)\. 

**parameters**  
\(Optional\) The parameters the document accepts\.   
For parameters that you reference often, we recommend that you store those parameters in Systems Manager Parameter Store and then reference them\. You can reference `String` and `StringList` Systems Manager parameters in this section of a document\. You can't reference Secure String Systems Manager parameters in this section of a document\. For more information, see [AWS Systems Manager Parameter Store](systems-manager-parameter-store.md)\.

**mainSteps**  
\(Required\) An object that can include multiple steps\. A step includes one or more actions \(or plugins\), a unique name for the action, inputs \(parameters\) for those actions, and optional outputs that can be used by other steps in the automation execution\. For a list of supported actions and their properties, see [Systems Manager Automation Actions Reference](automation-actions.md)\.

**outputs**  
\(Optional\) Data generated by the execution of this document that can be used in other processes\. For example, if your document creates a new AMI, you might specify "CreateImage\.ImageId" as the output value, and then use this output to create new instances in a subsequent automation execution\. For more information about outputs, see [Working with Inputs and Outputs](automation-aws-apis-calling.md#automation-aws-apis-calling-input-output)\.

**files**  
The script files \(and their checksums\) attached to the document and run during an automation execution\. Applies only to documents that include the `aws:executeScript` action and for which attachments have been specified in one or more steps\.   
For script runtime support, Automation documents currently support scripts for Python 3\.6, Python 3\.7, and PowerShell Core 6\.0\. For more information about including scripts in Automation documents, see [Creating Automation Documents That Run Scripts](automation-document-script.md) and [](automation-walk-document-builder.md)\.  
When you create an Automation document, or playbook, you specify attachment files using the option \-\-attachments \(AWS CLI\) or Attachments \(API and SDK\)\. You can specify the file location for both local files and files stored in Amazon S3 buckets\.  

```
files: 
 "file-name-1.zip": 
  checksums: 
   sha256: checksum
 "file-name-2.py": 
  checksums: 
   sha256: checksum
 "file-name-3.ps1": 
  checksums: 
   sha256: checksum
```

```
"files": {
        "file-name-1.zip": {
            "checksums": {
                "sha256": "checksum"
            }
        },
        "file-name-2.py": {
            "checksums": {
                "sha256": "checksum"
            }
        },
        "file-name-3.ps1": {
            "checksums": {
                "sha256": "checksum"
            }
        }

    }
```

## Schema Examples<a name="automation-doc-syntax-examples"></a>

**Automation Document Example \(YAML\)**  
The following sample shows the contents of an Automation document, in YAML format\. This working example of version 0\.3 of the document schema also demonstrates the use of Markdown to format document descriptions\.

```
description: >-
  ##Title: LaunchInstanceAndCheckState

  -----

  **Purpose**: This Automation document first launches an Amazon EC2 instance
  using the AMI ID provided in the parameter ```imageId```. The second step of
  this document continuously checks the instance status check value for the
  launched instance until the status ```ok``` is returned.


  ##Parameters:

  -----

  Name | Type | Description | Default Value

  ------------- | ------------- | ------------- | -------------

  assumeRole | String | (Optional) The ARN of the role that allows Automation to
  perform the actions on your behalf. | -

  imageId  | String | (Optional) The AMI ID to use for launching the instance.
  The default value uses the latest Amazon Linux AMI ID available. | {{
  ssm:/aws/service/ami-amazon-linux-latest/amzn-ami-hvm-x86_64-gp2 }}
schemaVersion: '0.3'
assumeRole: 'arn:aws:iam::111122223333::role/AutomationServiceRole'
parameters:
  imageId:
    type: String
    default: '{{ ssm:/aws/service/ami-amazon-linux-latest/amzn-ami-hvm-x86_64-gp2 }}'
    description: >-
      (Optional) The AMI ID to use for launching the instance. The default value
      uses the latest released Amazon Linux AMI ID.
  tagValue:
    type: String
    default: ' LaunchedBySsmAutomation'
    description: >-
      (Optional) The tag value to add to the instance. The default value is
      LaunchedBySsmAutomation.
  instanceType:
    type: String
    default: t2.micro
    description: >-
      (Optional) The instance type to use for the instance. The default value is
      t2.micro.
mainSteps:
  - name: LaunchEc2Instance
    action: 'aws:executeScript'
    outputs:
      - Name: payload
        Selector: $.Payload
        Type: StringMap
    inputs:
      Runtime: python3.6
      Handler: launch_instance
      Script: ''
      InputPayload:
        image_id: '{{ imageId }}'
        tag_value: '{{ tagValue }}'
        instance_type: '{{ instanceType }}'
      Attachment: launch.py
    description: >-
      **About This Step**


      This step first launches an EC2 instance using the ```aws:executeScript```
      action and the provided python script.
  - name: WaitForInstanceStatusOk
    action: 'aws:executeScript'
    inputs:
      Runtime: python3.6
      Handler: poll_instance
      Script: |-
        def poll_instance(events, context):
          import boto3
          import time

          ec2 = boto3.client('ec2')

          instance_id = events['InstanceId']

          print('[INFO] Waiting for instance status check to report ok', instance_id)

          instance_status = "null"

          while True:
            res = ec2.describe_instance_status(InstanceIds=[instance_id])

            if len(res['InstanceStatuses']) == 0:
              print("Instance status information is not available yet")
              time.sleep(5)
              continue

            instance_status = res['InstanceStatuses'][0]['InstanceStatus']['Status']

            print('[INFO] Polling to get status of the instance', instance_status)

            if instance_status == 'ok':
              break

            time.sleep(10)

          return {'Status': instance_status, 'InstanceId': instance_id}
      InputPayload: '{{ LaunchEc2Instance.payload }}'
    description: >-
      **About This Step**


      The python script continuously polls the instance status check value for
      the instance launched in Step 1 until the ```ok``` status is returned.
files:
  launch.py:
    checksums:
      sha256: 18871b1311b295c43d0f...[truncated]...772da97b67e99d84d342ef4aEXAMPLE
```

**Schema Structure Overview \(JSON\)**  
The following example shows the top\-level elements of a schema version 0\.3 Automation document in JSON format\.

```
{
    "description": "document-description",
    "schemaVersion": "0.3",
    "assumeRole": "{{assumeRole}}",
    "parameters": {
        "parameter-1": {
            "type": "String",
            "description": "parameter-1-description",
            "default": ""
        },
        {
        "parameter-2": {
            "type": "String",
            "description": "parameter-2-description",
            "default": ""
        }
    },
    "mainSteps": [
        {
            "name": "myStepName",
            "action": "action-name",
            "maxAttempts": 1,
            "inputs": {
                "Handler": "python-only-handler-name",
                "Runtime": "runtime-name",
                "Attachment": "script-or-zip-name"
            },
            "outputs": {
                "Name": "output-name",
                "Selector": "selector.value",
                "Type": "data-type"
            }
        }
    ],
    "files": {
        "script-or-zip-name": {
            "checksums": {
                "sha256": "checksum"
            },
            "size": 1234
        }
    }
}
```